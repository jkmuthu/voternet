<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VoterNet - Civic Network Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6fb;
            color: #1f2937;
            line-height: 1.5;
        }
        .topbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #ffffff;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .topbar-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 14px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .brand { font-size: 24px; color: #4c51bf; font-weight: 800; }
        .menu { display: flex; gap: 10px; flex-wrap: wrap; }
        .menu a {
            text-decoration: none;
            color: #4c51bf;
            font-weight: 600;
            padding: 8px 14px;
            border-radius: 8px;
        }
        .menu a:hover { background: #eef2ff; }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 70px 20px 60px;
        }
        .hero-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            align-items: center;
        }
        .hero h1 { font-size: 40px; margin-bottom: 14px; }
        .hero p { opacity: 0.96; font-size: 18px; margin-bottom: 20px; }
        .hero-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn {
            border: none;
            border-radius: 8px;
            padding: 11px 16px;
            cursor: pointer;
            font-weight: 700;
            text-decoration: none;
            display: inline-block;
        }
        .btn-light { background: #fff; color: #4c51bf; }
        .btn-dark { background: rgba(255,255,255,0.2); color: #fff; }

        .section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 36px 20px;
        }
        .section h2 {
            font-size: 30px;
            color: #312e81;
            margin-bottom: 8px;
        }
        .section-sub {
            color: #6b7280;
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
        }
        .card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 6px 14px rgba(0,0,0,0.04);
        }
        .card h3 { color: #4338ca; margin-bottom: 8px; }
        .card p { color: #4b5563; font-size: 14px; }

        .pricing { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 14px; }
        .price { font-size: 28px; font-weight: 800; color: #1f2937; margin: 8px 0; }

        .auth-wrap {
            max-width: 960px;
            margin: 0 auto 40px;
            padding: 0 20px;
        }
        .auth-box {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 14px 28px rgba(0,0,0,0.12);
            padding: 24px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
            padding-bottom: 12px;
        }
        .tab {
            background: #f3f4f6;
            border: none;
            border-radius: 8px;
            padding: 10px 14px;
            cursor: pointer;
            font-weight: 600;
        }
        .tab.active { background: #4c51bf; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .form-group { margin-bottom: 14px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
        }
        .form-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 14px;
            font-weight: 700;
            cursor: pointer;
        }
        .form-btn:disabled { opacity: 0.7; cursor: not-allowed; }
        .message {
            margin-top: 12px;
            padding: 10px;
            border-radius: 8px;
            display: none;
            font-size: 14px;
        }
        .message.success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; display: block; }
        .message.error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; display: block; }

        .status {
            margin-top: 14px;
            padding: 10px;
            border-radius: 8px;
            background: #eef2ff;
            color: #312e81;
            font-size: 14px;
        }
        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
            margin-top: 14px;
        }
        .quick-links a {
            text-decoration: none;
            color: white;
            border-radius: 8px;
            padding: 12px 14px;
            font-weight: 700;
            text-align: center;
        }
        .bg-indigo { background: #4f46e5; }
        .bg-green { background: #16a34a; }
        .bg-blue { background: #2563eb; }
        .bg-orange { background: #ea580c; }

        .muted { color: #6b7280; font-size: 14px; }
    </style>
</head>
<body>
    <header class="topbar">
        <div class="topbar-inner">
            <div class="brand">üó≥Ô∏è VoterNet</div>
            <nav class="menu">
                <a href="#features">Features</a>
                <a href="#tiers">User Types</a>
                <a href="#pricing">Pricing</a>
                <a href="#auth">Login / Register</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="hero-inner">
            <div>
                <h1>Digital Politics Platform for Voters, Parties, and Governance</h1>
                <p>VoterNet is a LinkedIn-for-Politics ecosystem with civic feed, campaign CRM, election workflows, and super-admin control.</p>
                <div class="hero-actions">
                    <a class="btn btn-light" href="#auth">Start Now</a>
                    <a class="btn btn-dark" href="/admin/devdoc">View Dev Roadmap</a>
                </div>
            </div>
            <div class="card" style="background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.25); color: white;">
                <h3 style="color: #fff;">Live Vision</h3>
                <p style="color: #eef2ff;">Public discovery, voter participation, party CRM, and admin governance in one secure platform.</p>
            </div>
        </div>
    </section>

    <section id="features" class="section">
        <h2>Core Platform Features</h2>
        <p class="section-sub">Current foundation + next rollout modules.</p>
        <div class="grid">
            <div class="card"><h3>Secure Authentication</h3><p>JWT access + refresh, role-aware access and profile APIs.</p></div>
            <div class="card"><h3>Election Engine</h3><p>Create, publish, activate, complete elections with live result endpoints.</p></div>
            <div class="card"><h3>Civic Feed</h3><p>Posts, comments, likes, shares, trending, and search with pagination.</p></div>
            <div class="card"><h3>Admin Controls</h3><p>Admin dashboard with system operations and development reference docs.</p></div>
            <div class="card"><h3>Party CRM (Upcoming)</h3><p>Digital voter records, team permissions, and campaign operation workflows.</p></div>
            <div class="card"><h3>Poll-Day Operations</h3><p>Turnout monitoring, field coordination, and incident workflows.</p></div>
        </div>
    </section>

    <section id="tiers" class="section">
        <h2>4-Tier User Model</h2>
        <p class="section-sub">Designed exactly for your platform vision.</p>
        <div class="grid">
            <div class="card"><h3>1) Public Users</h3><p>Browse platform, view content, learn features, sign up.</p></div>
            <div class="card"><h3>2) Registered Voters</h3><p>Profile, constituency mapping, feed participation, and civic actions.</p></div>
            <div class="card"><h3>3) Parties & Candidates</h3><p>Manage digital presence, teams, voter insights, and campaign execution.</p></div>
            <div class="card"><h3>4) Super Admin</h3><p>Governance, verification, compliance, moderation, and roadmap controls.</p></div>
        </div>
    </section>

    <section id="pricing" class="section">
        <h2>Planned Subscription Tiers</h2>
        <p class="section-sub">Pricing placeholder for party CRM launch.</p>
        <div class="pricing">
            <div class="card"><h3>Free</h3><div class="price">‚Çπ0</div><p>Basic voter access and civic participation.</p></div>
            <div class="card"><h3>Basic</h3><div class="price">‚Çπ2,999/mo</div><p>Starter party page and small voter segment tools.</p></div>
            <div class="card"><h3>Standard</h3><div class="price">‚Çπ9,999/mo</div><p>Advanced CRM + team workflows + analytics.</p></div>
            <div class="card"><h3>Enterprise</h3><div class="price">Custom</div><p>State-level operations and custom governance needs.</p></div>
        </div>
    </section>

    <section id="auth" class="auth-wrap">
        <div class="auth-box">
            <h2 style="margin-bottom: 8px;">Access VoterNet</h2>
            <p class="muted" style="margin-bottom: 16px;">Register, sign in, and open your voter or admin actions.</p>

            <div id="active-elections-preview" class="card" style="margin-bottom: 16px; display: none;">
                <h3>üî¥ Active Elections</h3>
                <div id="elections-list" class="muted">Loading...</div>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="register">Register</button>
                <button class="tab" data-tab="login">Login</button>
                <button class="tab" data-tab="profile">Profile</button>
            </div>

            <div id="register-tab" class="tab-content active">
                <form id="register-form" novalidate>
                    <div class="form-group"><label for="reg-firstname">First Name *</label><input id="reg-firstname" name="firstName" required minlength="2" maxlength="50" /></div>
                    <div class="form-group"><label for="reg-lastname">Last Name *</label><input id="reg-lastname" name="lastName" required minlength="2" maxlength="50" /></div>
                    <div class="form-group"><label for="reg-email">Email *</label><input id="reg-email" name="email" type="email" required /></div>
                    <div class="form-group"><label for="reg-password">Password *</label><input id="reg-password" name="password" type="password" required minlength="8" /></div>
                    <button id="register-btn" class="form-btn" type="submit">Create Account</button>
                </form>
                <div id="register-message" class="message"></div>
            </div>

            <div id="login-tab" class="tab-content">
                <form id="login-form" novalidate>
                    <div class="form-group"><label for="login-email">Email *</label><input id="login-email" name="email" type="email" required /></div>
                    <div class="form-group"><label for="login-password">Password *</label><input id="login-password" name="password" type="password" required /></div>
                    <button id="login-btn" class="form-btn" type="submit">Sign In</button>
                </form>
                <div id="login-message" class="message"></div>
            </div>

            <div id="profile-tab" class="tab-content">
                <div id="profile-content" class="card">
                    <p class="muted">Please login to view your profile.</p>
                </div>
                <div id="navigation-links" style="display:none;">
                    <h3 style="margin-top: 14px; margin-bottom: 8px;">Quick Actions</h3>
                    <div class="quick-links">
                        <a href="/dashboard/voter" id="voter-dashboard-link" class="bg-indigo" style="display:none;">üë• Voter Dashboard</a>
                        <a href="/dashboard/party" id="party-dashboard-link" class="bg-blue" style="display:none;">üèõÔ∏è Party Dashboard</a>
                        <a href="/vote.html" class="bg-indigo">üó≥Ô∏è Vote in Elections</a>
                        <a href="/results.html" class="bg-green">üìä View Results</a>
                        <a href="/civic/feed" class="bg-blue">üì∞ Civic Feed</a>
                        <a href="/admin.html" id="admin-link" class="bg-orange" style="display:none;">‚öôÔ∏è Admin Dashboard</a>
                    </div>
                </div>
                <div id="profile-message" class="message"></div>
            </div>

            <div id="api-status" class="status">API Server: <strong>Checking...</strong></div>
        </div>
    </section>

    <script src="config.js"></script>
    <script>
        let accessToken = localStorage.getItem('accessToken');
        let refreshToken = localStorage.getItem('refreshToken');

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach((tab) => {
                tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
            });

            document.querySelectorAll('.tab-content').forEach((content) => {
                content.classList.remove('active');
            });

            const activeContent = document.getElementById(`${tabName}-tab`);
            if (activeContent) activeContent.classList.add('active');

            if (tabName === 'profile') loadProfile();
        }

        function setMessage(targetId, text, type) {
            const el = document.getElementById(targetId);
            if (!el) return;
            el.textContent = text;
            el.className = `message ${type}`;
        }

        function clearMessage(targetId) {
            const el = document.getElementById(targetId);
            if (!el) return;
            el.textContent = '';
            el.className = 'message';
        }

        function sanitize(value) {
            return String(value || '').trim();
        }

        async function api(path, options = {}) {
            const headers = options.headers || {};
            if (accessToken) headers['Authorization'] = `Bearer ${accessToken}`;

            return fetch(`${API_URL}${path}`, {
                ...options,
                headers
            });
        }

        async function checkApiStatus() {
            const status = document.getElementById('api-status');
            try {
                const res = await fetch(`${API_URL}/health`);
                if (!res.ok) throw new Error('offline');
                status.innerHTML = 'API Server: <strong>Online</strong>';
                status.style.background = '#dcfce7';
                status.style.color = '#166534';
            } catch (error) {
                status.innerHTML = 'API Server: <strong>Offline</strong>';
                status.style.background = '#fee2e2';
                status.style.color = '#991b1b';
            }
        }

        async function loadActiveElections() {
            try {
                const res = await fetch(`${API_URL}/api/elections/active`);
                if (!res.ok) return;
                const data = await res.json();
                const preview = document.getElementById('active-elections-preview');
                const list = document.getElementById('elections-list');

                if (data?.data?.length > 0) {
                    preview.style.display = 'block';
                    list.innerHTML = data.data.slice(0, 3).map((e) => `${e.title} (${e.electionType})`).join('<br/>');
                }
            } catch (error) {
                console.log('Active election preview unavailable');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            clearMessage('register-message');

            const button = document.getElementById('register-btn');
            button.disabled = true;

            const firstName = sanitize(document.getElementById('reg-firstname').value);
            const lastName = sanitize(document.getElementById('reg-lastname').value);
            const email = sanitize(document.getElementById('reg-email').value);
            const password = document.getElementById('reg-password').value;

            if (firstName.length < 2 || lastName.length < 2) {
                setMessage('register-message', 'First and last name must be at least 2 characters.', 'error');
                button.disabled = false;
                return;
            }

            if (password.length < 8) {
                setMessage('register-message', 'Password must be at least 8 characters.', 'error');
                button.disabled = false;
                return;
            }

            try {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ firstName, lastName, email, password })
                });

                const payload = await res.json();
                if (!res.ok) throw new Error(payload.message || 'Registration failed');

                accessToken = payload.accessToken;
                refreshToken = payload.refreshToken;
                localStorage.setItem('accessToken', accessToken);
                localStorage.setItem('refreshToken', refreshToken);
                localStorage.setItem('token', accessToken);

                setMessage('register-message', 'Registration successful. You are now logged in.', 'success');
                showTab('profile');
                await loadProfile();
            } catch (error) {
                setMessage('register-message', error.message, 'error');
            } finally {
                button.disabled = false;
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            clearMessage('login-message');

            const button = document.getElementById('login-btn');
            button.disabled = true;

            const email = sanitize(document.getElementById('login-email').value);
            const password = document.getElementById('login-password').value;

            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const payload = await res.json();
                if (!res.ok) throw new Error(payload.message || 'Login failed');

                accessToken = payload.accessToken;
                refreshToken = payload.refreshToken;
                localStorage.setItem('accessToken', accessToken);
                localStorage.setItem('refreshToken', refreshToken);
                localStorage.setItem('token', accessToken);

                setMessage('login-message', 'Login successful.', 'success');
                showTab('profile');
                await loadProfile();
            } catch (error) {
                setMessage('login-message', error.message, 'error');
            } finally {
                button.disabled = false;
            }
        }

        async function loadProfile() {
            const profileContent = document.getElementById('profile-content');
            const navigationLinks = document.getElementById('navigation-links');
            const adminLink = document.getElementById('admin-link');
            const voterDashboardLink = document.getElementById('voter-dashboard-link');
            const partyDashboardLink = document.getElementById('party-dashboard-link');

            if (!accessToken) {
                profileContent.innerHTML = '<p class="muted">Please login to view your profile.</p>';
                navigationLinks.style.display = 'none';
                return;
            }

            try {
                const res = await api('/users/me');
                const payload = await res.json();
                if (!res.ok) throw new Error(payload.message || 'Could not load profile');

                profileContent.innerHTML = `
                    <h3 style="color:#4338ca; margin-bottom: 10px;">Welcome, ${payload.firstName} ${payload.lastName}</h3>
                    <p><strong>Email:</strong> ${payload.email}</p>
                    <p><strong>Role:</strong> ${payload.role}</p>
                    <p><strong>Status:</strong> ${payload.isActive ? 'Active' : 'Inactive'}</p>
                `;

                navigationLinks.style.display = 'block';

                if (voterDashboardLink) {
                    voterDashboardLink.style.display = ['voter', 'admin', 'volunteer'].includes(payload.role) ? 'block' : 'none';
                }

                if (partyDashboardLink) {
                    partyDashboardLink.style.display = ['campaign_staff', 'admin', 'election_official', 'volunteer'].includes(payload.role) ? 'block' : 'none';
                }

                if (payload.role === 'admin') {
                    adminLink.style.display = 'block';
                } else {
                    adminLink.style.display = 'none';
                }
            } catch (error) {
                profileContent.innerHTML = `<p class="muted">${error.message}</p>`;
                navigationLinks.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            document.querySelectorAll('.tab').forEach((btn) => {
                btn.addEventListener('click', () => showTab(btn.getAttribute('data-tab')));
            });

            document.getElementById('register-form').addEventListener('submit', handleRegister);
            document.getElementById('login-form').addEventListener('submit', handleLogin);

            await checkApiStatus();
            await loadActiveElections();
            if (accessToken) {
                showTab('profile');
                await loadProfile();
            }
        });
    </script>
</body>
</html>
